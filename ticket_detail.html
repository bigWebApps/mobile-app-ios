<!DOCTYPE html> 
<html> 
	<head> 
	<title>Ticket Details</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">    
	<meta name="format-detection" content="telephone=no">
    
    <link rel="stylesheet" href="css/jquery.mobile-1.1.0.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/helpdesk-base.css">
    <link rel="stylesheet" type="text/css" href="css/HelpDesk.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/jquery.mobile-1.1.0.min.js"></script>
        <script src="js/moment.min.js"></script>
        <script src="phonegap.js"></script>
        <script src="js/jquery.md5.min.js"></script>
        <script src="js/jquery.url.js"></script>
        <script src="js/handlebars-1.0.0.beta.6.js"></script>
        <script src="js/HelpDeskAPI.js"></script>
        <script src="js/helpdesk.js"></script>
    <script>	
       
		$( document ).delegate("#ticket_detail_main_page", "pageinit", function(){
			$('.res-gravatar').each(function(){
					var email = $.MD5($(this).data('gravatar'));			
					$(this).find('img').attr('src', "http://www.gravatar.com/avatar/" + email);
				});				
		});	
	</script>	
</head> 
<body>
<input id="ticketInfo" type="hidden"/>
<div data-role="page" data-role="page" id="ticket_detail_main_page">
	<div data-theme="h" data-position="fixed" class="ticket_detail_header" data-role="header">
	</div>
    <script id="ticket_detail_head" type="text/x-handlebars-template">
        <div class="ticket-det-box {{TicketStatus}}">
            <p class="status-det">{{TicketStatus}}</p>
            <p class="status-ticket-num">#{{TicketNumber}}</p>
        </div>
        <div class="ticket-det-head">
            <h1>{{UserFirstName}} {{UserLastName}}</h1>
            <h2>{{AccountName}}</h2>
        </div>
        <div class="ticket-tech-class">
            <div class="ticket-det-tech">
                <p class="smalllabel">TECH</p>
                <p>{{TechnicianFirstName}} {{TechnicianLastName}}</p>
            </div>
            <div class="ticket-det-class">
                <p class="smalllabel">CLASS</p>
                <p>{{ClassName}}</p>
            </div>
        </div>
        <div class="ticket-level-priority">
            <p class="det-icon"></p>
            <p class="det-level">Level: <span>{{Level}} - {{LevelName}} </span></p>
            <p class="det-priority">Priority: <span>{{Priority}} - {{PriorityName}}</span></p>
            <p class="det-date">{{dateFormat CreateTime format="calendar"}}</p>
        </div>
    </script>
    <!-- /header -->

	<div data-role="content" id="ticket-response-list">
    	<div class="ticket-det-subject">
        </div>
        <script id="ticket_detail_subject" type="text/x-handlebars-template">
            <h3>{{Subject}}</h3>
        </script>
        <ul id="ticketLogList" data-role="listview" data-theme="b">
        </ul>
        <script id="ticket_detail_logs" type="text/x-handlebars-template">
            {{#each TicketLogs}}
            <li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-theme="d" class="ticket-response">
                <div class="response-info">
                    <div class="response-date">
                        <p>{{dateFormat RecordDate format="utc"}}</p>
                    </div>
                    <div class="response-name">
                        <p class="res-name">{{UserFirstName}} {{UserLastName}}</p>
                        <span class="res-type">{{LogType}}</span>
                    </div>
                </div>
                <div class="response-text-img">
                    <div class="res-gravatar" data-gravatar="benpfohl@hotmail.com"><img class="res-gravatar-img" src="" width="25px" /></div>
                    <p class="res-text">
                        {{{Note}}}
                    </p>
                </div>
            </li>
            {{/each}}
        </script>
	</div><!-- /content -->
	
	<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme="h" data-id="ticket_det_footer" class="ticket-det-footer">
		<div data-role="navbar" data-theme="h">
			<ul>
				<li><a href="javascript:window.history.go($.mobile.urlHistory.stack.length * -1)" id="ticket_detail_main_page_back_link" data-ajax="false" data-theme="g" data-icon="back" >Back</a></li>
				<li><a href="home.html" data-ajax="false" data-theme="g" data-icon="home" data-iconshadow="false">Home</a></li>
				<li><a href="#ticket_info" data-theme="g" data-icon="info" data-iconshadow="false">Info</a></li>
				<li><a href="#alert_menu" data-theme="g" data-icon="app-more">More</a></li>
			</ul>
		</div><!-- /navbar -->        
	</div><!-- /footer -->
</div><!-- /page -->

<!-----------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
------------------------------ Sub Pages --------------------------------------------------------
-------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------>

<!------------------------------ Ticket Info --------------------------------------------------->

<div data-role="page" id="ticket_info">
    <div class="ticket_detail_header"  data-position="fixed" data-role="header" data-theme="h">
    </div> <!--/header -->
    
	<div data-role="content">
    	<h1>Ticket info</h1>
	</div><!-- /content -->
	
	<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme="h" data-id="ticket_det_footer" class="ticket-det-footer">
		<div data-role="navbar" data-theme="h">
			<ul>
				<li><a href="#ticket_detail_main_page" data-theme="g" data-icon="back" >Back</a></li>
				<li><a href="home.html" data-theme="g" data-icon="home" data-iconshadow="false">Home</a></li>
				<li><a href="#ticket_info" data-theme="g" data-icon="info" data-iconshadow="false">Info</a></li>
				<li><a href="#alert_menu" id="alert_more_action" data-theme="g" data-icon="app-more">More</a></li>
			</ul>
		</div><!-- /navbar -->        
	</div><!-- /footer -->
</div><!-- /page -->


<!------------------------------ More Menu ----------------------------------------------------->

<div data-role="page" id="alert_menu" data-theme="a">

    <script>
        function pickupTicket() {
            var ticketInfo = JSON.parse($("#ticketInfo").val());
            api.pickup_ticket({"Id": ticketInfo.Id,"OrganizationKey": getStorage("organization"),"InstanceKey": getStorage("instance"), "NoteText": "", "Password":$('#password').val()}, change_technician_ticket);
            return false;
        }

        function change_technician_ticket (data)
        {
            var ticketInfo = JSON.parse($("#ticketInfo").val());
            //$(".submitButton").removeAttr("disabled");
            if (data)
            {
                $("#ticket_detail_main_page_back_link").attr("href", "ticket_list.html");
                tooltip("Ticket #" + ticketInfo.TicketNumber +" picked up successfully!");
                $("#ticket_detail_main_page").page('destroy').page();
                $("#ticketLogList").listview('refresh')
                $.mobile.changePage("#ticket_detail_main_page");
            }
            else
                alert("Error!");
            return false;
        }
    </script>
    <div id="ticket-detail-more" data-role="content" data-theme="a">
        <a href="#ticket_response" id="ticket_response_action" data-role="button" data-theme="c">Add Response</a>
        <a href="#ticket_transfer" id="ticket_transfer_action" data-role="button" data-theme="c">Transfer to Another Tech</a>
        <a href="#ticket_addtime" id="ticket_addtime_action" data-role="button" data-theme="c">Record Time</a>
        <a href="javascript:pickupTicket()" id="ticket_pickup_action" data-role="button" data-theme="c">Pick Up Ticket</a>
        <a href="#ticket_close" id="ticket_close_action" data-role="button" data-theme="c">Close Ticket</a>
        <a href="#ticket_detail_main_page" id="ticket_cancel_action" data-role="button" data-theme="a" class="footerSlideButton">Cancel</a>
    </div> <!-- Content -->

    <div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme="h" data-id="ticket_det_footer" class="ticket-det-footer">
		<div data-role="navbar" data-theme="h">
			<ul>
				<li><a href="#ticket_detail_main_page" data-theme="g" data-icon="back" >Back</a></li>
				<li><a href="home.html" data-theme="g" data-icon="home" data-iconshadow="false">Home</a></li>
				<li><a href="#ticket_info" data-theme="g" data-icon="info" data-iconshadow="false">Info</a></li>
				<li><a href="#alert_menu" data-theme="g" data-icon="app-more">More</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
</div>

<!------------------------------ Add Response ----------------------------------------------------->


<div data-role="page" id="ticket_response">
    <div class="ticket_detail_header"  data-position="fixed" data-role="header" data-theme="h">
    </div> <!--/header -->

	<div data-role="content" data-theme="d">

        <script>
            // this is what is required for the on the mobile page load
            function addresponse_ticket_submit() {
                var ticketInfo = JSON.parse($("#ticketInfo").val());
                var response = htmlEscape($('#ticketresponse').val().trim());
                if (!response)
                    tooltip('Please enter response!');
                else
                    api.addresponse_ticket({"Id": ticketInfo.Id,"OrganizationKey": getStorage("organization"),"InstanceKey": getStorage("instance"), "NoteText": response, "Password":$('#password').val()}, addresponse_ticket_check);
                return false;
            }

            function addresponse_ticket_check (data)
            {
                var ticketInfo = JSON.parse($("#ticketInfo").val());
                //$(".submitButton").removeAttr("disabled");
                if (data)
                {
                    tooltip("Response added to Ticket #" + ticketInfo.TicketNumber +" successfully!");
                    $("#ticket_detail_main_page").page('destroy').page();
                    $("#ticketLogList").listview('refresh')
                    $.mobile.changePage("#ticket_detail_main_page");
                }
                else
                    alert("Error!");
                return false;
            }
        </script>

    <h3>Add Response</h3>    
        
        	<form action="#ticket_detail_main_page" method="post">
                  	<label for="ticketresponse" class="ui-hidden-accessible">Response</label>
                	<textarea name="ticketresponse" id="ticketresponse" placeholder="Add Ticket Reponse"></textarea>                 
            </form>       
        
        <a href="#ticket_detail_main_page" data-role="button" data-inline="true">Cancel</a>
		<a href="javascript:addresponse_ticket_submit()" data-role="button" data-inline="true" data-theme="b">Post Response</a>
    	
    </div><!--content-->
</div>


<!------------------------------ Ticket Transfer--------------------------------------------------->

<div data-role="page" id="ticket_transfer">
    <div class="ticket_detail_header"  data-position="fixed" data-role="header" data-theme="h">
    </div> <!--/header -->

	<div data-role="content" data-theme="d">     
        
        	<form action="#ticket_detail_main_page" method="post">
                	
                	<label><input type="checkbox" name="transfer_remove_user" /> Remove Al Petersen after transfer. </label>                	
                    <br>
                    <label><input type="checkbox" name="transfer_alternate" /> Make me the alternate </label>
                    <br>                   
                    <label for="tech_transfer" class="select">Transfer to </label>
                      <select name="status" id="tech_transfer" data-role="none">
                         <option value="Pat Clements">Pat Clements</option>
                         <option value="Jon Vickers">Jon Vickers</option>
                         <option value="Ben Pfohl">Ben Pfohl</option>
                      </select>   
                      
                  	<label for="transferdetails" class="ui-hidden-accessible">Details</label>
                	<textarea name="transferdetails" id="transferdetails" placeholder="Details"></textarea>
                 
            </form>       
        
        <a href="#ticket_detail_main_page" data-role="button" data-inline="true">Cancel</a>
		<a href="#ticket_detail_main_page" data-role="button" data-inline="true" data-theme="b">Transfer Ticket</a>
    	
    </div><!-- content -->    
    
</div>


<!------------------------------ Ticket Record Time ----------------------------------------------->

<div data-role="page" id="ticket_addtime">
    <div class="ticket_detail_header"  data-position="fixed" data-role="header" data-theme="h">
    </div> <!--/header -->

	<div data-role="content" data-theme="d">

            <h1>Coming soon in version 2.0</h1>
        	<form disabled="disabled" action="index.html" method="post">
                    <label for="time_tech">Technician</label>
                      <select name="time_tech" id="time_tech" data-role="none">
                        <option value="104171">Chernenko, Dmitriy</option>
                        <option value="71576">Clements, Mike</option>
                        <option value="38006">Clements, Patrick</option>
                        <option value="199175">Clements (gmail), Patrick</option>
                        <option value="155557">Durfee, Sherri</option>
                        <option value="139708">Dzoba, Yuriy</option>
                        <option value="59085">Gavrilov, Alexey</option>
                        <option value="58745">Gooz, Vladimir</option>
                        <option value="92249">Gooz (Test), Vladimir</option>
                        <option value="201075">Khramov, Michael</option>
                        <option value="116023">Korzhavin, Artem</option>
                        <option value="188796">Magazinov, Andrey</option>
                        <option value="132085">Mykytyuk, Yuriy</option>
                        <option selected="selected" value="176409">Pfohl, Ben</option>
                        <option value="167762">Pierce, Tori</option>
                        <option value="155909">Queue, Future Consideration</option>
                        <option value="199506">Queue, New Ticket</option>
                        <option value="84683">Queue, Pre-Development</option>
                        <option value="220244">Queue, SherpaDesk</option>
                        <option value="208278">Queue, WareHouse</option>
                        <option value="113737">Replicator, bigWebDesk</option>
                        <option value="157898">Shvalev, Andrey</option>
                        <option value="222227">Tolmachov, Eugene</option>
                        <option value="26">Vickers, Jon</option>
                        <option value="133129">Vladyka, Igor</option>
                        <option value="141155">Yuriev, Yura</option>
                      </select>

                    <label for="time_hours">Hours</label>
                    <input type="text" name="time_hours" id="time_hours" value="0:00" />
					<br>
                    <label for="time_task">Task Type</label>
                      <select name="time_task" id="time_task" data-role="none">
                        <option value="marketing/communications">Marketing/Communications</option>
                        <option value="SEM">SEM</option>
                        <option value="software dev">Software Dev</option>                        
                      </select>

                    <label for="time_details" class="ui-hidden-accessible">Time Details</label>
                    <textarea name="time_details" id="time_details" placeholder="Time Details"></textarea>

            </form>

        <a href="#ticket_detail_main_page" disabled="disabled" data-role="button" data-inline="true">Cancel</a>
		<a href="#ticket_detail_main_page" disabled="disabled" data-role="button" data-inline="true" data-theme="b">Record Time</a>
    	
    </div><!-- content -->    
    

</div>


<!------------------------------ Ticket Close ----------------------------------------------------->

<div data-role="page" id="ticket_close">
    <div class="ticket_detail_header"  data-position="fixed" data-role="header" data-theme="h">
    </div> <!--/header -->

	<div data-role="content" data-theme="d">

        <script>
            // this is what is required for the on the mobile page load
            function close_ticket_submit() {
                var ticketInfo = JSON.parse($("#ticketInfo").val());
                var notes = htmlEscape($('#closedetails').val().trim());
                if (!notes)
                    tooltip('Please enter close details!');
                else
                //$(".submitButton").attr("disabled","disabled");
                  api.close_ticket({"Id": ticketInfo.Id,"OrganizationKey": getStorage("organization"),"InstanceKey": getStorage("instance"), "NoteText": notes, "Password":$('#password').val()}, close_ticket_check);
                return false;
            }

            function close_ticket_check (data)
            {
                var ticketInfo = JSON.parse($("#ticketInfo").val());
                //$(".submitButton").removeAttr("disabled");
                if (data)
                {
                    tooltip("Ticket #" + ticketInfo.TicketNumber + " closed successfully!");
                    window.history.go($.mobile.urlHistory.stack.length * -1 -2);
                    //window.location.replace("org_inst.html");
                }
                else
                    alert("Error!");
                return false;
            }
        </script>
    	
        <h3>Close Ticket</h3>

        	<form action="index.html" method="post">
                
                <label><input type="checkbox" name="notify_user" checked="checked" /> Notify user via email. </label>
                
                <br/>
                <label for="closedetails" class="ui-hidden-accessible">Details</label>
                <textarea name="closedetails" id="closedetails" placeholder="Details"></textarea>
            </form>
        
        
        <a href="#ticket_detail_main_page" data-role="button" data-inline="true">Cancel</a>
		<a href="javascript:close_ticket_submit()" data-role="button" data-inline="true" data-theme="b">Close Ticket</a>
    	
    </div><!-- content -->
    
    

</div>


</body>
</html>






