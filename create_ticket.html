<!DOCTYPE html> 
<html> 
	<head> 
	<title>HelpDesk</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="css/jquery.mobile-1.1.0.min.css"/>
        <link rel="stylesheet" type="text/css" href="css/helpdesk-base.css">
        <link rel="stylesheet" type="text/css" href="css/HelpDesk.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/jquery.mobile-1.1.0.min.js"></script>
        <script src="js/moment.min.js"></script>
        <script src="js/jquery.md5.min.js"></script>
        <script src="js/jquery.url.js"></script>
        <script src="js/handlebars-1.0.0.beta.6.js"></script>
        <script src="js/HelpDeskAPI.js"></script>
        <script src="js/templates.js"></script>
        <script src="js/helpdesk.js"></script>
    </head>
    <body>
    <div id="container"/>
<div id="create_ticket_page" data-role="page">
	<div data-role="content" data-theme="d">
        <script>
            /*$("#create_ticket_page").on("pageshow", function(e) {
                //console.log("Ready to bring the awesome.");
                var t_tickettechnicians_options = Handlebars.compile( $('#ht_tech_list').html() );
                var parsetechnicians = function (data) {
                    if (!data)
                    {
                        return;
                    }

                    $.each(data, function (index, tech) {
                        if ((tech.FirstName + tech.LastName).trim().length == 0)
                            data[index].FirstName = tech.Email;
                    });

                    $('select#tech_list').empty();
                    $('select#tech_list').append(t_tickettechnicians_options([{"Id":0, "FirstName":"Use System Routing (Default)"}]));
                    $('select#tech_list').append(t_tickettechnicians_options(data));
                    $('select#tech_list').listview("refresh");
                };
                api.technicians_list({"OrganizationKey": getStorage("organization"),"InstanceKey": getStorage("instance")},parsetechnicians);

                var sugList = $("#select_customer_list");

                $("#select_customer_name").on("input", function(e) {
                    $.mobile.showPageLoadingMsg();
                    var text = $(this).val();
                    if(text.length < 1) {
                        sugList.html("");
                        sugList.listview("refresh");
                        $('#select_customer_list').children('li').on('vclick', get_customer_name);
                    } else {
                        api.users_list({"SearchText": text, "OrganizationKey": getStorage("organization"),"InstanceKey": getStorage("instance")}, function(res) {
                            if (res)
                            {
                            $('#select_customer_list').show("fast");
                            var str = "<li data-id='0'>Make Me the Customer</li>";
                            $.each(res, function (index, tech) {
                                str += "<li data-id='"+tech.Id+"'>";
                                if (tech.LastName.trim().length > 0)
                                    str +=  tech.LastName + ", ";
                                if (tech.FirstName.trim().length > 0)
                                    str += tech.FirstName + " - ";
                                if (tech.Email.trim().length > 0)
                                    str += tech.Email;
                                str += "</li>";
                            });
                            sugList.html(str);
                            sugList.listview("refresh");
                            $('#select_customer_list').children('li').on('vclick', get_customer_name);
                            }
                        },"json");
                    }
                });

                function get_customer_name(){
                    //alert('Selected Name=' + $(this).attr('data-name'));
                    $("#select_customer_name").val("");
                    $("#select_customer_name").attr("placeholder",$(this).text());
                    $('#select_customer_list').hide("fast");
                };
            });
            */

            function ticket_create_submit() {
                var subject = htmlEscape($('#subject').val().trim());
                if (!subject)
                    tooltip('Please enter Subject!');
                else
                api.pickup_ticket({"Id": $('#ticketId').val(),"OrganizationKey": getStorage("organization"),"InstanceKey": getStorage("instance"), "NoteText": "", "Password":$('#password').val()}, pickup_ticket_postback);
                return false;
            }

            function pickup_ticket_postback (data)
            {
                //$(".submitButton").removeAttr("disabled");
                if (data)
                {
                    $("#ticket_detail_main_page_back_link").attr("href", "ticket_list.html");
                    tooltip("Ticket #" + $('#ticketNumber').val() +" picked up successfully!");
                    //$("#ticket_detail_main_page").page('destroy').page();
                    //$("#ticket_detail_response_list").listview('refresh')
                    $.mobile.changePage("#ticket_detail_main_page", {reloadPage : true});
                }
                else
                    alert("Error!");
                return false;
            }
        </script>
    	<div align="center" style="margin-bottom: 30px;"><img src="img/helpdesk_logo.png"></div>		
		<form data-ajax="false" onsubmit="return ticket_create_submit();">

            <input type="text" id="select_customer_name" value="" placeholder="Customer"/>
            <ul id="select_customer_list" data-role="listview" data-inset="true"></ul>
            <br>
				  <select name="select-account" id="account" data-role="none">
				     <option value="bigwebapps">bigWebApps</option>
				     <option value="someoneelse">Someone Else</option>
				     <option value="anothercompany">Another Company</option>
				  </select>
                <br>
            <select name="status" id="tech_list" data-role="none">
            </select>
            <script id="ht_tech_list" type="text/x-handlebars-template">
                {{#each this}}
                <option value="{{Id}}">{{FirstName}} {{LastName}}</option>
                {{/each}}
            </script>
         		<br>
            	<label><input type="checkbox" name="alternate" /> Make me the alternate </label>
                <br>              
				<input type="text" name="subject" id="subject" value="" placeholder="Subject"/>
				<br>
				<textarea name="details" id="details" placeholder="Details"></textarea>
				
                <a href="home.html" data-role="button" data-inline="true">Cancel</a>
				
                <button type="submit" data-theme="b" data-inline="true" name="submit" value="submit-value" >
					Submit Ticket
				</button>
                
                
                	
			</form>
	</div><!-- /content -->



</div><!-- /page -->

</body>
</html>