<!DOCTYPE html>
<html>
<head>
    <title>HelpDesk</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="css/jquery.mobile-1.1.0.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/helpdesk-base.css">
    <link rel="stylesheet" type="text/css" href="css/HelpDesk.css">
	<script src="phonegap.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.md5.min.js"></script>
    <script src="js/jquery.mobile-1.1.0.min.js"></script>
    <script src="js/HelpDeskAPI.js"></script>
    <script src="js/helper.js"></script>
	
    <script>
        // this is what is required for the on the mobile page load
        pageLoad(function(){

            api = new HelpDeskAPI('test');

            var parseorgs = function (data) {
                if (!data)
                {
                    $.mobile.changePage("login.html");
                    return;
                }
                $.each(data, function (index, tek) {
                    //Add after the default val
                    $("#orgs option:eq(0)").after("<option value='" + tek.Key + "'>" + tek.Name + "</option>");
                    $("#orgs").show();
                    $("#login").hide();

                });
            }

            var parseinsts = function (data) {
                if (!data) {
                    $("#login").show();
                    return;
                }

                $.each(data, function (index, tek) {
                    //Add after the default val
                    $("#insts option:eq(0)").after("<option value='" + tek.Key + "'>" + tek.Name + "</option>");
                    $("#orgs").hide();
                    $("#insts").show();
                });
            }

            var set_org = function () {
                alert(2);
                api.instances([],parseinsts);
            }

            var set_inst = function () {
                alert(1);
                $.mobile.changePage("home.html");
            }

            api.organizations([],parseorgs);

            $("#orgs").change(function () {
                $("#orgs option:selected").each(function () {
                    var org_key = $(this).val();
                    if (org_key != 0) {
                        alert(org_key);
                        api.set_organization([org_key], set_org);
                        //api_instances(parseinsts);
                    }
                });
            })
                    .change();
            $("#insts").change(function () {
                $("#insts option:selected").each(function () {
                    var inst_key = $(this).val();
                    if (inst_key != 0) {
                        api.set_instance([inst_key], set_inst);
                        //window.location.replace("home.html");
                    }
                });
            })
            .change();

        });
    </script>

</head>
<body>

<div data-role="page">

    <div data-role="header" data-position="fixed" data-theme="h">
        <h1>HelpDesk</h1>
    </div>
    <!-- /header -->

    <div id="content" data-role="content">
        <a href="login.html" id="login" data-role="button" data-transition="flip" data-theme="g" data-iconpos="right"
           data-icon="arrow-r">Login to HelpDesk</a>
        <a style="display:none" id="home" href="home.html" data-role="button" data-transition="flip" data-theme="g"
           data-iconpos="right" data-icon="arrow-r">Home View</a>
        <select style="display:none" name="select-organization" id="orgs" data-role="none">
            <option value="0">-- Select Organization --</option>
        </select>
        <select style="display:none" name="select-instance" id="insts" data-role="none">
            <option value="0">-- Select Instance --</option>
        </select>        
    </div>
    <!-- /content -->
    
</div>
<!-- /page -->

</body>
</html>